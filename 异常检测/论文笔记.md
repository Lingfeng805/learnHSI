

# 通过背景和潜在异常字典构建的高光谱异常检测

- 基于两个精心设计的字典：**背景字典**和**潜在异常字典**；
- 为了有效的**检测异常**和**消除噪声影响**，原始图像被分为三部分：**背景**、**异常**、**噪声**；——异常检测任务被视为**矩阵分解问题**；
- 考虑到背景的**均匀性**，异常的**稀疏性**，模型中加入**低秩**和**稀疏约束**；然后，利用背景和异常先验知识构造背景和潜在异常字典；
- 通过使用JSR模型在其局部 区域内计算的残差来定义一个标准，即一个像素的异常水平；然后结合加权项来减轻噪声和背景的影响；
- **背景和异常之间的统计分布差异可用于检测**



为了精确地对背景和异常信息建模，提出一种新的HSI异常检测方法，基于良好设计的低秩表示的背景和稀疏表达潜在异常字典；将原始数据分成三部分，背景+异常+噪声；由于HSI的同质性，背景成分具有低阶特性；异常成分具有稀疏性；

- 使用JSR模型描述纯背景，不受杂波和异常的影响；
- 为了充分利用HSI中隐藏的异常信息，构造一个潜在的异常字典；
- 根据异常等级（AL）选择字典中的原子， 这个异常等级是利用JSR模型计算的残差结合一个加权项得来的；
- 利用精心构造的背景和潜在异常字典，利用稀疏和低秩分解模型将HSI分解为背景、异常、噪声；

### 高光谱异常检测字典构建方法示意图

- 首先，使用 PCA 降维得到低维的三维立方体。
- 然后，通过一个固定大小的窗口将原始图像分割成多个三维区域。
- 然后，使用基于IPD K-means将区域分成若干类。
- 利用基于类的过完备字典的 JSR 模型重构每个区域对应的原始谱像素。
- 利用 JSR 系数构造背景，利用 JSR 中的残差构造潜在异常字典。
- JSR——Joint Sparse Representation联合稀疏表示

![image-20210811113111072](E:/software/Typora/pictures/image-20210811113111072.png)

- 构建背景字典：考虑了场景中每个区域的局部和非局部相似性，提出利用 JSR 系数来选择原子。
- 为了充分利用场景中隐藏的异常先验知识，提出利用 JSR 模型构造潜在的局部区域残差异常字典。



## 二、方法细节介绍

### A.背景、异常、噪声分解模型

- 对于一个维度为**h×w×d**的高光谱数据，h,w为空间大小，d为波段数；
- 背景像素之间存在很强的相关性，即某个背景像素可由其他背景像素的组合来表示；
  - **X=BZ+A+E**
  - BZ为背景成分，B=[b1,b2,...,bnB]为背景字典，$$n_B$$​​​为字典原子的数量；Z=[Z1,Z2,...,Zn]为相应的表示系数，A=[a1,a2,...,an]为异常分量，E=[e1,e2,...,en]为噪声分量；
- 对于HSI，局部区域中的像素大多是同构的，因此假设背景具有**低秩属性**；对于噪声分量，HSI中主要存在2种噪声，稀疏噪声和高斯随机噪声；L2,1范数对这两种噪声具有高的鲁棒性，因此利用L2,1范数对噪声进行建模；
  - 因此，目标函数可表示为——**$$min_{Z,A,E} rank(Z)+β||A||_l+λ||E||_{2,1}$$​​**     s.t **X=BZ+A+E**
  - rank(Z)表示矩阵Z的秩，Z是低秩表示的系数矩阵；
  - L2,1范数定义为：矩阵列的L2范数和；——即矩阵先以每一列为单位，求每一列的F范数，然后再将得到的结果求L1范数；
    - F范数：矩阵的各个元素平方之和再开平方根，通常也叫做矩阵的L2范数，它的优点是一个凸函数，可求导求解，易于计算；
    - L1范数：矩阵中每个元素绝对值之和，可近似表示系数；
  - ![image-20210811151629807](E:/software/Typora/pictures/image-20210811151629807.png)
- **使用特定的分布估计异常是困难的，因为同一副高光谱图像中的异常可能不同。**因此，与背景有显著差异的像素被提取出来，作为其他异常像素的潜在先验；隐藏的异常可以用字典中的强异常原子线性表示：**A=TS**,T=[t1,t2,...,tnT]为潜在的异常字典，$$n_T$$​​为潜在异常字典的原子数，S=[s1,s2,...,sn]为对应的系数矩阵；在生成潜在异常字典时，可能会错误地包含一些不是异常的像素——为避免该情况，假设在重建异常像素时只有潜在的异常原子处于活跃状态；
  - 异常检测模型：**$$min_{Z,S,E} ||Z||_*+β||S||_1+λ||E||_{2,1}$$​​**     s.t **X=BZ+TS+E**  *(4)*
  - $$||*||_*$$​ 代表矩阵的核范数；​
  - 根据异常分量A=TS各列的L2范数可以计算出属于异常的每个像素的响应值，最后通过一个阈值来确定异常；

### B、背景字典的构建

- 对一幅HSI图像的同一局部中的像素来说，它们可能有着相同的结构，因此，这些区域可用一些普通原子的稀疏线性组合共同近似表示：
  - **$$min  ||Ψ||_{row,0}$$**     s.t   U=VΨ+R
  - U=[u1,u2,...,uL]是一个从三维局部区域立方体展开的包含L个光谱像素的二维矩阵，Ψ为对应的表示系数（仅少数行非零），R=[r1,r2,...,rL]为基于V和Ψ构造后的残差，**$$||Ψ||_{row,0}$$​**  表示Ψ的非零行。
- JSR模型：从一个过完备字典中选择一些普通原子来表示局部区域内的每个光谱像素；它通过少数原子的线性组合来捕捉原始区域的公共部分，这反应了该区域一致的光谱信息；显然，对于异常检测任务，一个区域中的公共部分倾向于被视为背景，所以选择常用的原子作为基础来重建背景；所有从不同类别的背景材料中选择的原子构成背景字典；——**1.如何为JSR模型构建一个过完备字典？2.如何设计度量标准来度量从字典中选择的常用原子？**
  - 1.最简单的思路：利用HSI中所有原始光谱像素构造JSR模型的字典；——费时：字典太大，计算每个小区域；来自不同材料的众多光谱也许会提高JSR模型的表示能力，但实际上会降低描述特定材料的能力（光谱不是越多越好）；当重建一个局部区域时要使用很多来自不同类别的像素。所以，提取公共结构时全局字典可能会混淆；
  - 考虑到局部区域之间的非局部相似性，使用扩展的K-means将所有像素分成几个聚类中，即每个聚类都包含一个相似的底层结构以降低复杂度。
    - 设研究的小区域为U，维度为win×win×d,其中win是窗口尺寸，U的二维形式为d×L，L=win×win。
    - **IPD——image patch distance**:图像块距离；
    - ![image-20210811170248515](E:/software/Typora/pictures/image-20210811170248515.png)
    - o(a,b)为非局部谱相似函数，**（括号内为欧几里得距离）**，UP,UQ代表从区域中选择的两个区域的二维矩阵；
    - **基于IPD的K-means**
    - ![**基于IPD的K-means**](E:/software/Typora/pictures/image-20210811170652681.png)
    - 随着类数量的增加，每个类中的区域数量通常为减少；因此，较小的聚类中的区域不足以通过JSR模型构建一个过完备字典；——**解决方案：将非过完备类根据IPD距离合并到最近的类中。**
    - 通过上述方式，将所有区域分成若干个集群（聚类）；对每个聚类，过完备字典由类中全部光谱项组成，该过完备字典用于重建该局部区域；字典中常用的原子将被视为**最终的背景字典中的原子**。
    - 每个类的JSR模型的最终公式：![image-20210812100638505](E:/software/Typora/pictures/image-20210812100638505.png)
    - $$U{^c}{_i}$$​表示第C类的第i个区域；i=[1,2,...,$$n^C$$​]; $$n^C$$​=[$$n^1$$​,$$n^2$$​,...,$$n^K$$​];  c=[1,2,...,K];  $$n^C$$​表示第C类中区域的个数；K表示类的个数；  $$G^C$$​=[$$g{^C}{_1},g{^C}{_2},...g{^C}{_{n^C}}]$$​表示拥有$$n^c$$​个原子的第C类的过完备字典；$$Ψ{^c_i}$$表示对应系数，$$R{^C_i}$$表示残差；

- - 2.统计每个类中各个原子的频率；（将频率定义为归一化后的JSR系数之和）
  - ![image-20210812102746760](E:/software/Typora/pictures/image-20210812102746760.png)
  - $$Ψ{^c_{i,j}}$$表示第c类中第i个区域的第j列；$$ γ$$​​表示归一化项； $$P^C$$​​是一个向量，其中每个元素的值反映了作为背景原子的加权频率；按降序对其排序，选择顶部的原子(即频率最高的)作为第C类的背景字典原子；最终，从每个类中选择的所有原子构成背景字典B.

### C、潜在的异常字典构建

- 对一个区域的中心像素而言，相邻像素的平均残差越大，意味着中心像素很可能是异常的。此处，区域的平均残差作为中心像素的异常响应；
- 对于第C类中第i个区域，异常响应的计算公式如下：![image-20210812110359823](E:/software/Typora/pictures/image-20210812110359823.png)
- $$r{^C_{i,j}}$$​表示第C类中第i个区域的第j列;  第C类的错误为：![image-20210812110617747](E:/software/Typora/pictures/image-20210812110617747.png)
- 将K类中每个区域的平均残差进行级联，定义一个异常像素的响应值AL,![image-20210812110805265](E:/software/Typora/pictures/image-20210812110805265.png)
- $$χ$$​为标准化部分，AL是一个每个元素是一个区域异常响应值的向量；
- **仅提取明显的异常像素远远不够，一方面，噪声总是存在；另一方面，对于复杂场景，一个区域内也许包含看不同类型的背景材质，这将导致背景材料可能会被误判为潜在异常像素；即，并不是所有重建残差大的像素都是异常像素！**
- **每个类中经常使用的原子往往是背景原子，而那些只参与重构包含异常区域的原子往往是异常的，各类异常原子具有选择频率低、系数大的特点。** 定义异常权重AW:![image-20210812112551457](E:/software/Typora/pictures/image-20210812112551457.png)
- $$F^C$$为向量，每个元素反映各个原子的选择频数；![image-20210812112735819](E:/software/Typora/pictures/image-20210812112735819.png)
- sgn为符号函数，权重AL为:![image-20210812112837841](E:/software/Typora/pictures/image-20210812112837841.png)
- AW=$$[AW^1,AW^2,...,AW^K]$$​​.​**将其按降序排列，选择顶部的像素作为潜在异常字典T的原子。**



### D、优化和计算复杂度



## 三、实验结果和讨论



## 四、总结





## 五、代码

- 【1】demo.py——“一个例子，可用作测试代码”

